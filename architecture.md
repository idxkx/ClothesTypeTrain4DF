# 喵搭服装识别训练平台 - 架构说明

本文档描述了"喵搭服装识别训练平台"的模块化架构设计，旨在提供清晰的组件分离和逻辑流程。

## 1. 目录结构

```
ClothesTypeTrain4DF/
│
├── main_ui.py              # 主入口文件
├── model.py                # 模型定义
├── trainer.py              # 训练器实现
├── dataset.py              # 数据集处理
│
├── components/             # UI组件目录
│   ├── config_panel.py     # 配置面板组件
│   ├── training_panel.py   # 训练面板组件
│   ├── training_functions.py # 训练功能实现
│   ├── history_viewer.py   # 历史记录查看组件
│   ├── gpu_monitor.py      # GPU监控组件
│   ├── report_generator.py # 报告生成组件
│   └── metadata_manager.py # 元数据管理组件
│
├── utils/                  # 工具函数目录
│   ├── state_manager.py    # 状态管理工具
│   ├── file_utils.py       # 文件处理工具
│   ├── time_utils.py       # 时间处理工具
│   └── path_manager.py     # 路径管理工具
│
├── models/                 # 保存训练模型的目录
│
├── config.json             # 配置文件
└── training_results.json   # 训练结果记录文件
```

## 2. 模块描述

### 2.1 主入口模块

- **main_ui.py**: 应用入口点，负责初始化Streamlit界面并组织各个组件的布局。定义了主要页面结构和导航逻辑。

### 2.2 UI组件

- **config_panel.py**: 训练参数配置界面，包含模型选择、训练策略、学习率等参数设置。
- **training_panel.py**: 训练流程控制界面，负责启动训练并更新UI。
- **training_functions.py**: 实现训练过程的核心函数，包括数据加载、模型初始化、训练循环等。
- **history_viewer.py**: 历史训练记录查看和比较组件。
- **gpu_monitor.py**: GPU使用情况监控和图表显示组件。
- **report_generator.py**: 生成训练诊断报告和模型测试报告。
- **metadata_manager.py**: 管理模型元数据的创建和查看。

### 2.3 工具函数

- **state_manager.py**: 管理Streamlit的session_state，包括初始化、更新和重置功能。
- **file_utils.py**: 处理文件操作，如路径规范化、结果加载/保存等。
- **time_utils.py**: 处理时间格式化和计算，如剩余时间估计。
- **path_manager.py**: 管理项目中的路径，包括配置文件路径和模型保存路径。

## 3. 数据流

1. **参数配置流**: 用户在配置面板中设置训练参数 → 参数被传递给训练面板
2. **训练流**: 训练面板启动训练过程 → 训练函数执行训练循环 → 实时更新UI
3. **结果处理流**: 训练完成后生成报告 → 保存训练结果 → 更新历史记录
4. **历史查看流**: 加载历史记录 → 展示记录列表 → 用户选择查看详情

## 4. 状态管理

应用状态通过Streamlit的`session_state`集中管理，主要包括：

- **训练状态**: 包括是否训练中、是否请求停止等
- **日志记录**: 存储训练过程中产生的日志消息
- **监控数据**: 存储GPU使用情况和训练指标历史数据
- **UI状态**: 保存UI组件的状态，如选中的模型等

## 5. 设计原则

1. **组件化**: 将UI和功能划分为独立的组件，便于维护和扩展
2. **状态集中化**: 使用统一的状态管理机制
3. **异常处理**: 各组件实现完善的异常捕获和处理机制
4. **用户体验**: 提供实时更新和清晰的视觉反馈

## 6. 扩展性

该架构允许以下方式的扩展：

- **添加新模型**: 只需在model.py中添加新的模型定义
- **扩展训练策略**: 可以在config_panel.py中添加新的训练策略
- **添加新的图表/显示**: 可以在现有的UI组件中添加新的可视化方式
- **增加数据集支持**: 可以扩展dataset.py以支持新的数据集格式 